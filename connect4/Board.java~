import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import java.util.*;
import java.awt.image.BufferedImage;
import javafx.embed.swing.JFXPanel;
/**
     * Board is a type of JFrame that has the Buttons and graphical interface
     * This class corelates directly with information stored in PlayingBoard
     * Author: Sergei Levashov
     */
public class Board extends JFrame{
    private PlayingBoard Brain;
    private JLabel label;
    private JLabel glow;
    private Player p1;
    private Player p2;
    private JPanel tokens;
    private Position[][] offsets;
    /**
     * Board constructor, initializes the JFframe
     * Sergei Levashov
     */
    public Board(){
        super("Connect 4");
        JFXPanel fxPanel = new JFXPanel();
        Brain = new PlayingBoard();
        setLayout(null);
    }
    /**
     * generates a new board and buttons
     * Sergei Levashov
     */
    public void addBoard(Player player1, Player player2)
    {
        p1 = player1;
        p2 = player2;
        label = new JLabel();
        tokens = new JPanel();
        label.setIcon(new ImageIcon("images/boards/connect4board2.png"));
        
        tokens.setLayout(null);
        tokens.setOpaque(false);
        glow = new JLabel();
        glow.setIcon(new ImageIcon("images/gloweffectsquare.png"));
        
        tokens.setBackground(new Color(0,0,0,0));
        tokens.add(glow);
        add(tokens);
        add(label);
        tokens.setBounds(0,0,1000,800);
        label.setBounds(0,0,1000,800);
        generateButtons(getInsets(),Brain);
        repaint();
    }
    /**
     * adds a single token, at the specified y and x
     * Sergei Levashov
     */
    public void addToken(int y, int x)
    {
        JLabel test = new JLabel();
        if(Brain.getPlayerNum() == 1)
        {
            test.setIcon(new ImageIcon("images/people/" + p1.getPath()));
        }
        else
        {
            test.setIcon(new ImageIcon("images/people/" + p2.getPath()));
        }
        test.setBounds(y-8,x-9,85,85);        
        tokens.add(test);
        tokens.repaint();
    }
    /**
     * generates the 6X7 grid of buttons and makes them invisible
     * Sergei Levashov
     */
    private void generateButtons(Insets insets,PlayingBoard Brain)
    {
        ArrayList<Piece> buttons = new ArrayList<Piece>();
        offsets = new Position[6][7];
        int LeftInset = 165;
        int count = 1;
        int TopInset = 129;
        int a = 0;
        int e = 0;
        for(int y = 0; y < 6; y++)
        {
            for(int x = 0; x < 7; x++) //adds in all buttons
            {
                Piece p = new Piece(y,x,Brain,this);
                buttons.add(p);
                p.addListener(); //this adds a listener in the instance of the button
            }
        }
        
        for(Piece b : buttons)
        {
            add(b);
            b.setBounds(LeftInset + insets.left, TopInset + insets.top,70,70);
            offsets[a][e] = new Position(LeftInset + insets.left, TopInset + insets.top);
            e++;
            makeButtonInvisible(b);
            LeftInset += 100;
                if(count == 7)
                {
                    a++;
                    e=0;
                    LeftInset = 165;
                    TopInset += 103;
                    count = 0;
                }
            count++;
        }
        
        
        //here we add the buttons for the vs boxes on the top right of the board
        Piece pb1 = new Piece();
        Piece pb2 = new Piece();
        pb2.setBounds(615,34,70,70);
        pb1.setBounds(317,34,70,70);
        add(pb1);
        add(pb2);
        makeButtonInvisible(pb2);
        makeButtonInvisible(pb1);
        p1.addVoiceBoxListener(pb1,"left");
        p2.addVoiceBoxListener(pb2,"right");
        
        //back button
        Piece backButton = new Piece();
        backButton.setBounds(30, 32,70,70);
        add(backButton);
        backButtonListener(backButton);
        makeButtonInvisible(backButton);
    }
    /**
     * creates listener at back button
     * Sergei Levashov
     */
    private void backButtonListener(Piece b) //implement change to new JFrame here
    {
        b.addActionListener(new ActionListener()
        {
            public void actionPerformed(ActionEvent e)
            {
                System.out.println("pressed back button");
            }
        });
    }
    /**
     * makes the JButton passed invisible, by reference
     * Sergei Levashov
     */
    private void makeButtonInvisible(Piece b) //makes an individual button invisible
    {
        b.setOpaque(false);
        b.setContentAreaFilled(false);
        b.setBorderPainted(false);
        
    }
    /**
     * returns offset array generated by generateButtons()
     * Sergei Levashov
     */
    public Position[][] getOffsetArray()
    {
        return offsets;
    }
    public void shiftGlow(int pNum)
    {
        if(pNum == 1)
        {
            glow.setBounds(587,12,120,120);
        }
        else
        {
            glow.setBounds(296,12,120,120);
        }
        tokens.repaint();
    }
}